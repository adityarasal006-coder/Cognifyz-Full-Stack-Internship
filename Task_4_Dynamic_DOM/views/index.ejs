<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Terminal | Task 4</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
</head>
<body class="bg-black">

    <div class="container py-5">
        <div class="row g-4 justify-content-center">
            
            <div class="col-lg-5">
                <div class="elite-card p-4 animate-reveal">
                    <h2 class="text-cyan fw-bold mb-4 border-bottom border-secondary pb-2">DATA UPLINK</h2>
                    <form id="task4Form">
                        <div class="mb-3">
                            <label class="text-white small fw-bold">OPERATOR ID</label>
                            <input type="text" id="username" class="elite-input" required>
                        </div>
                        <div class="mb-3">
                            <label class="text-white small fw-bold">EMAIL ACCESS</label>
                            <input type="email" id="email" class="elite-input" required>
                        </div>
                        <div class="mb-4">
                            <label class="text-white small fw-bold">ENCRYPTION KEY</label>
                            <input type="password" id="password" class="elite-input" oninput="analyzeStrength()">
                            <div class="progress mt-2" style="height: 4px; background: #111;">
                                <div id="strengthBar" class="progress-bar" style="width: 0%"></div>
                            </div>
                            <small id="strengthText" class="text-muted mt-1 d-block">Strength: Pending</small>
                        </div>
                        <button type="submit" class="btn-cyan-glow w-100 py-3 fw-bold">INITIALIZE TRANSFER</button>
                    </form>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="elite-card p-4 h-100 glass-effect animate-slide-right">
                    <h2 class="text-white fw-bold mb-4">LIVE SYSTEM LOGS</h2>
                    <div id="logContainer" class="log-box">
                        <div class="text-muted italic">[Waiting for incoming data...]</div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        let currentStrength = 0;

        // Step 1: Complex Validation Rules
        function analyzeStrength() {
            const pass = document.getElementById('password').value;
            const bar = document.getElementById('strengthBar');
            const txt = document.getElementById('strengthText');
            
            let score = 0;
            if (pass.length > 6) score++;
            if (/[A-Z]/.test(pass)) score++;
            if (/[0-9]/.test(pass)) score++;
            if (/[^A-Za-z0-9]/.test(pass)) score++;

            currentStrength = score;
            const colors = ['#ff4d4d', '#ff944d', '#ffd633', '#00ff88'];
            const widths = ['25%', '50%', '75%', '100%'];
            
            bar.style.width = widths[score-1] || '0%';
            bar.style.backgroundColor = colors[score-1] || '#111';
            txt.innerText = score >= 3 ? "Strength: Secure" : "Strength: Vulnerable";
            txt.style.color = colors[score-1];
        }

        // Step 2 & 3: Dynamic DOM & Async Routing
        document.getElementById('task4Form').onsubmit = async (e) => {
            e.preventDefault();
            
            const payload = {
                username: document.getElementById('username').value,
                email: document.getElementById('email').value,
                strength: currentStrength
            };

            const response = await fetch('/api/validate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const result = await response.json();

            if (result.success) {
                // Dynamic DOM Update: Add new log without refreshing
                const container = document.getElementById('logContainer');
                if(container.querySelector('.text-muted')) container.innerHTML = '';
                
                const newLog = document.createElement('div');
                newLog.className = "log-entry animate-reveal p-2 border-bottom border-dark text-success";
                newLog.innerHTML = `>> AUTHENTICATED: ${result.user.username} | ${new Date().toLocaleTimeString()}`;
                container.prepend(newLog);
                
                document.getElementById('task4Form').reset();
                document.getElementById('strengthBar').style.width = '0%';
            } else {
                alert("ACCESS DENIED: " + result.message);
            }
        };
    </script>
</body>
</html>